(()=>{"use strict";const t={props:["url","controlData","name","params","itemKey"],data:function(){return{items:[],disabled:!1,query:this.getItemName(this.controlData),timerId:null}},methods:{search:function(){if(this.disabled)return;let t=this;t.timerId&&clearTimeout(t.timerId),t.timerId=setTimeout((function(){t.items=[],t.disabled=!0;let e=Object.assign(t.params||{},{query:t.query});t.query.length>=2&&t._ajax(t.url,e,(function(e){t.disabled=!1,e.success&&(t.items=e.data)}))}),500)},selectItem:function(t){for(let e in t)t.hasOwnProperty(e)&&this.controlData.hasOwnProperty(e)&&(this.controlData[e]=t[e]);this.items=[],this.query=this.getItemName(t)},getItemName:function(t){return this.itemKey&&t.hasOwnProperty(this.itemKey)?t[this.itemKey]:t.name},_ajax(t,e,s){window.jQuery.ajax({method:"POST",url:wc_ukr_shipping_globals.ajaxUrl,data:Object.assign({action:t,_token:wc_ukr_shipping_globals.nonce},e),dataType:"json",success:function(t){s(t)}})}},template:'\n    <div id="wcus_edit_order_settlement_control" class="wcus-search-control">\n      <input v-for="(data, key) in controlData" \n        type="hidden" \n        :id="name + \'_\' + key" \n        :name="name + \'_\' + key"\n        v-model="controlData.key" />\n      <div class="wcus-search-control__query-wrap">\n        <input type="text" :disabled="disabled" @input="search" v-model="query" class="wcus-form-control wcus-search-control__query" autocomplete="off">\n        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 511.999 511.999" style="enable-background:new 0 0 511.999 511.999;" xml:space="preserve"><g><g><path d="M508.874,478.708L360.142,329.976c28.21-34.827,45.191-79.103,45.191-127.309c0-111.75-90.917-202.667-202.667-202.667\n\t\t\tS0,90.917,0,202.667s90.917,202.667,202.667,202.667c48.206,0,92.482-16.982,127.309-45.191l148.732,148.732\n\t\t\tc4.167,4.165,10.919,4.165,15.086,0l15.081-15.082C513.04,489.627,513.04,482.873,508.874,478.708z M202.667,362.667\n\t\t\tc-88.229,0-160-71.771-160-160s71.771-160,160-160s160,71.771,160,160S290.896,362.667,202.667,362.667z"></path></g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>\n      </div>\n      <div class="wcus-search-control__results" :class="{ \'active\': items.length }">\n        <div v-for="item in items" class="wcus-search-control__result" :class="{ \'disabled\': item.disable }" @click.stop="selectItem(item)">{{ getItemName(item) }}</div>\n      </div>\n    </div>\n  '};var e=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.classes},[s("div",{staticClass:"wcus-edit-address__title"},[t._v(t._s(t.$t("Editing shipping data")))]),t._v(" "),s("div",{staticClass:"wcus-edit-address__content"},[s("div",{staticClass:"wcus-form-group"},[s("label",{attrs:{for:"wcus_edit_order_shipping_type"}},[t._v(t._s(t.$t("Shipping type")))]),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.shippingType,expression:"shippingType"}],staticClass:"wcus-form-control",attrs:{id:"wcus_edit_order_shipping_type"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.shippingType=e.target.multiple?s:s[0]}}},[s("option",{attrs:{value:"warehouse"}},[t._v(t._s(t.$t("to the warehouse")))]),t._v(" "),s("option",{attrs:{value:"address"}},[t._v(t._s(t.$t("to the doors")))])])]),t._v(" "),s("keep-alive",["warehouse"===t.shippingType?s("edit-warehouse"):s("edit-address")],1),t._v(" "),s("div",{staticClass:"wcus-edit-address__submit"},[s("button",{staticClass:"wcus-btn wcus-btn--primary wcus-btn--md",on:{click:function(e){return e.preventDefault(),t.save.apply(null,arguments)}}},[t._v(t._s(t.$t("Save")))])])],1)])};e._withStripped=!0;var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"wcus-form-group"},[s("label",{attrs:{for:"wcus_edit_order_city"}},[t._v(t._s(t.$t("City")))]),t._v(" "),s("zen-ui-select",{attrs:{id:"wcus_edit_order_city",name:"wcus_edit_order_city",options:t.default_cities,"default-option":t.current_city,"http-transport":t.cityTransport,"search-box":"","custom-class":"static"},on:{change:t.updateCity}})],1),t._v(" "),s("div",{staticClass:"wcus-form-group"},[s("label",{attrs:{for:"wcus_edit_order_warehouse"}},[t._v(t._s(t.$t("Warehouse")))]),t._v(" "),s("zen-ui-select",{ref:"warehouses",attrs:{id:"wcus_edit_order_warehouse",name:"wcus_edit_order_warehouse","default-option":t.current_warehouse,"http-transport":t.warehouseTransport,minSearchLength:"1","search-box":"","custom-class":"static",paging:""},on:{change:t.updateWarehouse}})],1)])};function r(){return new class{constructor(t){window.jQuery||console.error("jQuery not found."),this.config=t,this.xhr=null,this.config.globals||(this.config.globals={})}async post(t,e){const s=window.jQuery,r=this;return new Promise((function(a,i){r.xhr=s.ajax({method:"POST",url:r.config.url,data:Object.assign({action:t},r.config.globals,e),dataType:"json",success:function(t){r.xhr=null,a(t)},error:function(t,e,s){r.xhr=null,i({jqXHR:t,textStatus:e,errorThrown:s})}})}))}async postCors(t,e){const s=window.jQuery,r=this;return new Promise((function(a,i){r.xhr=s.ajax({method:"POST",url:t,data:JSON.stringify(e),dataType:"json",contentType:"applicat3ion/json",timeout:3e3,success:function(t){r.xhr=null,a(t)},error:function(t,e,s){r.xhr=null,i({jqXHR:t,textStatus:e,errorThrown:s})}})}))}abort(){this.xhr&&(this.xhr.abort(),this.xhr=null)}}({url:wc_ukr_shipping_globals.ajaxUrl,globals:{_token:wc_ukr_shipping_globals.nonce,lang:wc_ukr_shipping_globals.lang}})}s._withStripped=!0;const a=new r,i=class{async fetch(t){return await a.post("wcus_search_cities",{query:t.query.trim()})}abort(){a.abort()}},n=new r,o=class{constructor(t){this.data=t}async fetch(t){return await n.post("wcus_admin_search_warehouses",{city_ref:this.data.city_ref,query:t.query.trim(),page:t.page})}abort(){n.abort()}},c={messages:{ru:{"Editing shipping data":"Редактироание данных доставки","Shipping type":"Тип доставки","to the warehouse":"в отделение","to the doors":"до дверей",Save:"Сохранить",City:"Город",Warehouse:"Отделение",Settlement:"Населенный пункт",Street:"Улица","House number":"Номер дома","Flat number":"Номер квартиры"},ua:{"Editing shipping data":"Редагування даних доставки","Shipping type":"Тип доставки","to the warehouse":"у відділення","to the doors":"до дверей",Save:"Зберегти",City:"Місто",Warehouse:"Відділення",Settlement:"Населений пункт",Street:"Вулиця","House number":"Номер будинку","Flat number":"Номер квартири"}}};var l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.classes},[s("div",{staticStyle:{width:"0",height:"0",overflow:"hidden"}},[s("input",{attrs:{type:"hidden",name:t.name,id:t.id},domProps:{value:t.activeOption.value}})]),t._v(" "),s("div",{staticClass:"zen-ui-select__value",class:{disabled:t.opened},on:{click:t.toggle}},[s("span",{staticClass:"zen-ui-select__value-text"},[t._v(t._s(t.text))]),t._v(" "),s("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 129 129"}},[s("path",{attrs:{d:"m121.3,34.6c-1.6-1.6-4.2-1.6-5.8,0l-51, 51.1-51.1-51.1c-1.6-1.6-4.2-1.6-5.8,0-1.6, 1.6-1.6,4.2 0,5.8l53.9,53.9c0.8,0.8 1.8, 1.2 2.9,1.2 1,0 2.1-0.4 2.9-1.2l53.9-53.9c1.7-1.6 1.7-4.2 0.1-5.8z"}})])]),t._v(" "),s("div",{staticClass:"zen-ui-select__dropdown",class:{active:t.opened}},[t.searchBox?s("div",{staticClass:"zen-ui-select__search"},[s("input",{staticClass:"zen-ui-select__search-input",attrs:{type:"text",placeholder:t.strings.search},domProps:{value:t.query},on:{keydown:t.validateKeyInput,input:t.searchResults}})]):t._e(),t._v(" "),s("div",{staticClass:"zen-ui-select__options"},[t.items.length?[t._l(t.items,(function(e){return s("div",{key:e.value,staticClass:"zen-ui-select__option",class:{"zen-ui-select__option--current":t.activeOption.value===e.value},on:{click:function(s){return s.stopPropagation(),t.selectOption(e)}}},[t._v("\n          "+t._s(e.name)+"\n        ")])})),t._v(" "),t.loading?s("div",{staticClass:"zen-ui-select__option zen-ui-select__option--disabled zen-ui-select__option--loading"},[t._v(t._s(t.strings.loading))]):[t.paging&&t.more?s("div",{staticClass:"zen-ui-select__option zen-ui-select__option--more",on:{click:t.loadMore}},[t._v("\n            "+t._s(t.strings.more)+"\n          ")]):t._e()]]:[t.loading?s("div",{staticClass:"zen-ui-select__option zen-ui-select__option--disabled zen-ui-select__option--loading"},[t._v(t._s(t.strings.loading))]):[t.firstLoaded?s("div",{staticClass:"zen-ui-select__option zen-ui-select__option--disabled"},[t._v(t._s(t.strings.notFound))]):[t.disableAutoFetch?s("div",{staticClass:"zen-ui-select__option zen-ui-select__option--disabled"},[t._v(t._s(t.strings.enterMoreChars))]):t._e()]]]],2)])])};l._withStripped=!0;let u=0;const d="default",h="search";let p=null;function _(t,e,s,r,a,i,n,o){var c,l="function"==typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=s,l._compiled=!0),r&&(l.functional=!0),i&&(l._scopeId="data-v-"+i),n?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},l._ssrRegister=c):a&&(c=o?function(){a.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:a),c)if(l.functional){l._injectStyles=c;var u=l.render;l.render=function(t,e){return c.call(e),u(t,e)}}else{var d=l.beforeCreate;l.beforeCreate=d?[].concat(d,c):[c]}return{exports:t,options:l}}var m=_({name:"zen-ui-select",i18n:{messages:{ru:{"Select value":"Выберите значение","Loading...":"Загрузка...","Enter value for search":"Введите значение для поиска","Load more...":"Загрузить еще...","Nothing found":"Ничего не найдено","Enter more chars":"Введите больше символов"},ua:{"Select value":"Оберіть значення","Loading...":"Завантаження...","Enter value for search":"Введіть значення для пошуку","Load more...":"Завантажити ще...","Nothing found":"Нічого не знайдено","Enter more chars":"Введіть більше символів"}}},props:{id:String,name:String,value:String,options:{type:Array,default:[]},defaultOption:Object,messages:Object,minSearchLength:{type:Number,default:2},customClass:{type:String,default:""},searchBox:Boolean,paging:Boolean,disableAutoFetch:Boolean,httpTransport:Object,fetchDelay:{type:Number,default:300}},data(){return{controlId:++u,query:"",defaultPool:this.options,searchPool:[],loading:!1,opened:!1,dataContext:d,currentPage:1,more:!0,firstLoaded:!1,activeOption:{name:"",value:""},strings:{placeholder:"",loading:"",search:"",more:"",notFound:"",enterMoreChars:""}}},computed:{items(){return h===this.dataContext?this.searchPool:this.defaultPool},classes(){return["zen-ui-select","zen-ui-select-"+this.controlId,this.customClass]},text(){return this.activeOption.name||this.strings.placeholder}},watch:{defaultOption:{handler:function(t){this.activeOption=Object.assign({},t)},deep:!0},value(t){for(let e=0;e<this.items.length;e++)if(this.items[e].value===t){this.activeOption=Object.assign({},this.items[e]);break}}},methods:{async searchResults(t){this.query=t.target.value,null!==p&&(clearTimeout(p),p=null),this.abortRequest(),this.query.length>=this.minSearchLength?this._startSearch():(this.setDefaultContext(),this.clearPool(this.searchPool),this.loading=!1)},selectOption(t){this.activeOption=Object.assign({},t),this.close(),this.$emit("change",t)},async open(){this.opened=!0,this.disableAutoFetch||this.firstLoaded||this.items.length||(this.defaultPool=await this.fetchData());let t=new CustomEvent("zen.select.open",{detail:{controlId:this.controlId}});document.body.dispatchEvent(t)},validateKeyInput(t){[13].includes(t.keyCode)&&t.preventDefault()},close(){this.opened=!1},toggle(){this.opened?this.close():this.open()},async fetchData(){if(!this.httpTransport||"function"!=typeof this.httpTransport.fetch)return[];this.abortRequest(),this.loading=!0;try{const t=await this.httpTransport.fetch({query:this.query,page:this.paging?this.currentPage:0});return"abort"!==t.status&&(this.loading=!1),t.success?(this.firstLoaded=!0,this.paging&&"undefined"!==t.data.more&&(this.more=t.data.more),this.paging?t.data.items:t.data):[]}catch(t){return[]}},async loadMore(){this.currentPage++,(await this.fetchData()).forEach((t=>{this.appendOption(t)}))},abortRequest(){this.httpTransport&&"function"==typeof this.httpTransport.abort&&this.httpTransport.abort()},getOptionByValue(t){for(let e=0;e<this.defaultPool.length;e++)if(this.defaultPool[e].value===t)return this.defaultPool[e];return null},clear(){this.abortRequest(),this.clearPool(this.defaultPool),this.clearPool(this.searchPool),this.loading=!1,this.currentPage=1,this.firstLoaded=!1,this.query="",this.activeOption.name="",this.activeOption.value=""},appendOption(t){h===this.dataContext?this.searchPool.push(t):this.defaultPool.push(t)},setSearchContext(){this.dataContext=h},setDefaultContext(){this.dataContext=d},clearPool(t){t.splice(0,t.length)},async _startSearch(){p=null,this.setSearchContext(),this.clearPool(this.searchPool),this.currentPage=1,this.fetchDelay>0?(this.loading=!0,p=setTimeout((async()=>{this.searchPool=await this.fetchData()}),this.fetchDelay)):this.searchPool=await this.fetchData()},getDefaultStrings(){return{placeholder:this.$t("Select value"),loading:this.$t("Loading..."),search:this.$t("Enter value for search"),more:this.$t("Load more..."),notFound:this.$t("Nothing found"),enterMoreChars:this.$t("Enter more chars")}}},created(){if(this.defaultOption)this.activeOption=this.defaultOption;else if(this.value)for(let t=0;t<this.items.length;t++)if(this.items[t].value===this.value){this.activeOption=Object.assign({},this.items[t]);break}this.strings=Object.assign(this.getDefaultStrings(),this.messages||{}),this.items.length&&(this.firstLoaded=!0)},mounted(){const t=this;document.body.addEventListener("click",(function(e){e.target.closest(".zen-ui-select-"+t.controlId)||t.close()})),document.body.addEventListener("zen.select.open",(function(e){e.detail.controlId!==t.controlId&&t.close()}))}},l,[],!1,null,null,null);m.options.__file="frontend/vendor/zen/ui/select.vue";const g=m.exports,{mapState:v}=WCUkrShipping.UI;var f=_({name:"edit-warehouse",components:{"zen-ui-select":g},i18n:c,data(){return{cityTransport:new i,warehouseTransport:new o({city_ref:()=>this.$store.state.edit_order.current_city.value})}},computed:{...v("edit_order",["default_cities","current_city","current_warehouse"])},methods:{updateCity(t){this.$store.state.edit_order.current_city={name:t.name,value:t.value},this.$refs.warehouses.clear()},updateWarehouse(t){this.$store.state.edit_order.current_warehouse={name:t.name,value:t.value}}}},s,[],!1,null,null,null);f.options.__file="frontend/js/order-edit/components/EditWarehouse.vue";const w=f.exports;var y=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"wcus-form-group"},[s("label",{attrs:{for:"wcus_edit_order_settlement"}},[t._v(t._s(t.$t("Settlement")))]),t._v(" "),s("zen-ui-select",{attrs:{id:"wcus_edit_order_settlement",name:"wcus_edit_order_settlement","http-transport":t.settlementTransport,"default-option":t.current_settlement,"disable-auto-fetch":"","search-box":"","custom-class":"static"},on:{change:t.updateSettlement}})],1),t._v(" "),s("div",{staticClass:"wcus-form-group"},[s("label",{attrs:{for:"wcus_edit_order_street"}},[t._v(t._s(t.$t("Street")))]),t._v(" "),s("zen-ui-select",{attrs:{id:"wcus_edit_order_street",name:"wcus_edit_order_street","http-transport":t.streetTransport,"default-option":t.current_street,"disable-auto-fetch":"","search-box":"","custom-class":"static"},on:{change:t.updateStreet}})],1),t._v(" "),s("div",{staticClass:"wcus-form-group"},[s("label",{attrs:{for:"wcus_edit_order_house"}},[t._v(t._s(t.$t("House number")))]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.house,expression:"house"}],staticClass:"wcus-form-control",attrs:{type:"text",id:"wcus_edit_order_house",name:"wcus_edit_order_house"},domProps:{value:t.house},on:{input:function(e){e.target.composing||(t.house=e.target.value)}}})]),t._v(" "),s("div",{staticClass:"wcus-form-group"},[s("label",{attrs:{for:"wcus_edit_order_flat"}},[t._v(t._s(t.$t("Flat number")))]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.flat,expression:"flat"}],staticClass:"wcus-form-control",attrs:{type:"text",id:"wcus_edit_order_flat",name:"wcus_edit_order_flat"},domProps:{value:t.flat},on:{input:function(e){e.target.composing||(t.flat=e.target.value)}}})])])};y._withStripped=!0;const b=new r,C=class{async fetch(t){return await b.post("wcus_search_settlements",{query:t.query.trim()})}abort(){b.abort()}},x=new r,S=class{constructor(t){this.data=t}async fetch(t){return await x.post("wcus_search_streets",{query:t.query.trim(),settlement_ref:this.data.settlement_ref()})}abort(){x.abort()}},{mapState:O}=WCUkrShipping.UI;var $=_({name:"edit-address",components:{"zen-ui-select":g},i18n:c,props:["orderId"],data:function(){return{settlementTransport:new C,streetTransport:new S({settlement_ref:()=>this.$store.state.edit_order.current_settlement.value})}},computed:{...O("edit_order",["current_settlement","current_street"]),house:{get(){return this.$store.state.edit_order.current_house},set(t){this.$store.state.edit_order.current_house=t}},flat:{get(){return this.$store.state.edit_order.current_flat},set(t){this.$store.state.edit_order.current_flat=t}}},methods:{updateSettlement(t){this.$store.state.edit_order.current_settlement=Object.assign({},t)},updateStreet(t){this.$store.state.edit_order.current_street=Object.assign({},t)}}},y,[],!1,null,null,null);$.options.__file="frontend/js/order-edit/components/EditAddress.vue";const P=$.exports,{mapState:k,mapActions:T}=WCUkrShipping.UI;var z=_({components:{EditWarehouse:w,EditAddress:P},i18n:c,data:()=>({locked:!1}),computed:{shippingType:{get(){return this.$store.state.edit_order.shipping_type},set(t){this.$store.state.edit_order.shipping_type=t}},classes(){return["wcus-edit-address",{"wcus-state-loading":this.locked}]}},methods:{async save(){this.locked=!0,(await this.$store.dispatch("edit_order/save")).success?location.reload():(this.locked=!1,alert("Произошла ошибка при сохранении данных."))}}},e,[],!1,null,null,null);z.options.__file="frontend/js/order-edit/components/App.vue";const j=z.exports,q=new r;function E(t){return{shipping_type:t.shipping_type,area_ref:"",city_ref:t.current_city.value,city_name:t.current_city.name,warehouse_ref:t.current_warehouse.value,warehouse_name:t.current_warehouse.name}}function I(t){return{shipping_type:t.shipping_type,settlement:{ref:t.current_settlement.value,full:t.current_settlement.name,name:t.current_settlement.meta.name,area:t.current_settlement.meta.area,region:t.current_settlement.meta.region},street:{ref:t.current_street.value,name:t.current_street.meta.name,full:t.current_street.name},house:t.current_house,flat:t.current_flat}}const D={state:{},actions:{save:async({commit:t,state:e})=>await q.post("wcus_save_shipping_address",{order_id:e.order_id,shipping_address:"warehouse"===e.shipping_type?E(e):I(e)})}};WCUkrShipping.UI.registerStore("edit_order",D),WCUkrShipping.UI.component("search-control",t);const L=document.getElementById("wcus-order-shipping-edit-btn");L&&L.addEventListener("click",(function(t){t.preventDefault(),t.stopImmediatePropagation(),WCUkrShipping.Modal.open({type:"component",component:j,classes:["wcus-modal"]})}))})();