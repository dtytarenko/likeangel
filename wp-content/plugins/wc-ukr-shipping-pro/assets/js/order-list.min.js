(()=>{"use strict";var t=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"wcus-settings wcus-settings--full"},[r("div",{staticClass:"wcus-settings__header"},[r("h1",{staticClass:"wcus-settings__title"},[t._v(t._s(t.$t("page_heading")))])]),t._v(" "),r("div",{staticClass:"wcus-settings__content"},[r("toolbar"),t._v(" "),r("order-list")],1)])};t._withStripped=!0;var e=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"wcus-orders-toolbar"},[t.ordersWithoutTTNSelected||t.ordersWithTTNSelected?r("div",{staticClass:"wcus-orders-toolbar__buttons"},[t.ordersWithoutTTNSelected?r("button",{staticClass:"wcus-btn wcus-btn--primary wcus-btn--md",on:{click:function(e){return e.preventDefault(),t.createOrdersTTN.apply(null,arguments)}}},[t._v(t._s(t.$t("btn_generate_invoice")))]):t._e(),t._v(" "),t.ordersWithTTNSelected?r("button",{staticClass:"wcus-btn wcus-btn--default wcus-btn--md",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.printTTN.apply(null,arguments)}}},[t._v(t._s(t.$t("btn_print_invoice")))]):t._e(),t._v(" "),t.ordersWithTTNSelected?r("button",{staticClass:"wcus-btn wcus-btn--danger wcus-btn--md",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.deleteTTN.apply(null,arguments)}}},[t._v(t._s(t.$t("btn_delete_invoice")))]):t._e()]):t._e(),t._v(" "),t.ordersWithoutTTNSelected?r("div",[r("div",{staticClass:"wcus-form-group wcus-form-group--horizontal",staticStyle:{"margin-bottom":"15px"}},[r("label",{staticClass:"wcus-switcher"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.optionAutoTracking,expression:"optionAutoTracking"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.optionAutoTracking)?t._i(t.optionAutoTracking,null)>-1:t.optionAutoTracking},on:{change:function(e){var r=t.optionAutoTracking,s=e.target,i=!!s.checked;if(Array.isArray(r)){var n=t._i(r,null);s.checked?n<0&&(t.optionAutoTracking=r.concat([null])):n>-1&&(t.optionAutoTracking=r.slice(0,n).concat(r.slice(n+1)))}else t.optionAutoTracking=i}}}),t._v(" "),r("span",{staticClass:"wcus-switcher__control"})]),t._v(" "),r("div",{staticClass:"wcus-control-label"},[t._v(t._s(t.$t("btn_add_to_tracking")))])])]):t._e(),t._v(" "),r("div",{staticClass:"wcus-orders-toolbar__filter"},[r("div",{staticClass:"wcus-orders-toolbar__filter-control"},[r("label",{attrs:{for:"wcus-orders-limit"}},[t._v(t._s(t.$t("label_limit")))]),t._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:t.limit,expression:"limit"}],staticClass:"wcus-form-control",attrs:{id:"wcus-orders-limit"},on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.limit=e.target.multiple?r:r[0]}}},[r("option",{attrs:{value:"20"}},[t._v("20")]),t._v(" "),r("option",{attrs:{value:"50"}},[t._v("50")]),t._v(" "),r("option",{attrs:{value:"100"}},[t._v("100")])])]),t._v(" "),r("div",{staticClass:"wcus-orders-toolbar__filter-control"},[r("label",{attrs:{for:"wcus-orders-page"}},[t._v(t._s(t.$t("label_page")))]),t._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:t.page,expression:"page"}],staticClass:"wcus-form-control",attrs:{id:"wcus-orders-page"},on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.page=e.target.multiple?r:r[0]}}},t._l(t.count_pages,(function(e){return r("option",[t._v(t._s(e))])})),0)])])])};e._withStripped=!0;const r={messages:{ru:{page_heading:"Список заказов",text_loading:"Загрузка...",btn_generate_invoice:"Создать накладные",btn_print_invoice:"Распечатать накладные",btn_delete_invoice:"Удалить накладные",label_limit:"Лимит записей",label_page:"Страница",th_order:"Заказ",th_status:"Статус",th_shipping:"Доставка",th_date:"Дата создание",th_total:"Итого",th_invoice:"Экспресс-накладная",th_invoice_status:"Статус накладной",row_create_ttn:"Создать накладную",state_queue:"В очереди...",state_deleting:"Удаление...",btn_add_to_tracking:"Добавить в трекинг"},ua:{page_heading:"Список замовлень",text_loading:"Завантаження...",btn_generate_invoice:"Створити накладні",btn_print_invoice:"Роздрукувати накладні",btn_delete_invoice:"Видалити накладні",label_limit:"Ліміт записів",label_page:"Сторінка",th_order:"Замовлення",th_status:"Статус",th_shipping:"Доставка",th_date:"Дата створення",th_total:"Загалом",th_invoice:"Експрес-накладна",th_invoice_status:"Статус накладної",row_create_ttn:"Створити накладну",state_queue:"У черзі...",state_deleting:"Видалення...",btn_add_to_tracking:"Додати у трекінг"},en:{page_heading:"Order list",text_loading:"Loading...",btn_generate_invoice:"Create invoices",btn_print_invoice:"Print invoices",btn_delete_invoice:"Delete invoices",label_limit:"Limit records",label_page:"Page",th_order:"Order",th_status:"Status",th_shipping:"Shipping",th_date:"Date created",th_total:"Total",th_invoice:"Invoice",th_invoice_status:"Invoice status",row_create_ttn:"Create invoice",state_queue:"Queue...",state_deleting:"Deleting...",btn_add_to_tracking:"Add to tracking"}}};function s(t,e,r,s,i,n,o,a){var c,d="function"==typeof t?t.options:t;if(e&&(d.render=e,d.staticRenderFns=r,d._compiled=!0),s&&(d.functional=!0),n&&(d._scopeId="data-v-"+n),o?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},d._ssrRegister=c):i&&(c=a?function(){i.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:i),c)if(d.functional){d._injectStyles=c;var l=d.render;d.render=function(t,e){return c.call(e),l(t,e)}}else{var _=d.beforeCreate;d.beforeCreate=_?[].concat(_,c):[c]}return{exports:t,options:d}}var i=s({i18n:r,computed:{...WCUkrShipping.UI.mapState("orders",["count_pages"]),...WCUkrShipping.UI.mapGetters("orders",["ordersWithTTN","ordersWithoutTTN"]),limit:{get:function(){return this.$store.state.orders.limit},set:function(t){this.$store.state.orders.limit=t,this.loadOrders()}},page:{get:function(){return this.$store.state.orders.page},set:function(t){this.$store.state.orders.page=t,this.loadOrders()}},optionAutoTracking:{get:function(){return this.$store.state.orders.options.autoTracking},set:function(t){this.$store.state.orders.options.autoTracking=t?1:0}},ordersWithTTNSelected:function(){return this.ordersWithTTN.length>0},ordersWithoutTTNSelected:function(){return this.ordersWithoutTTN.length>0}},methods:{...WCUkrShipping.UI.mapActions("orders",["loadOrders","createOrdersTTN","printTTN","deleteTTN"])}},e,[],!1,null,null,null);i.options.__file="frontend/js/order-list/components/toolbar.vue";const n=i.exports;var o=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.loading?r("div",[t._v(t._s(t.$t("text_loading")))]):r("div",{staticClass:"wcus-table-wrap"},[r("table",{staticClass:"wcus-table"},[r("thead",[r("tr",[r("th"),t._v(" "),r("th",[t._v(t._s(t.$t("th_order")))]),t._v(" "),r("th",[t._v(t._s(t.$t("th_status")))]),t._v(" "),r("th",[t._v(t._s(t.$t("th_shipping")))]),t._v(" "),r("th",[t._v(t._s(t.$t("th_date")))]),t._v(" "),r("th",[t._v(t._s(t.$t("th_total")))]),t._v(" "),r("th",{staticClass:"text-center"},[t._v(t._s(t.$t("th_invoice")))]),t._v(" "),r("th",{staticClass:"text-center"},[t._v(t._s(t.$t("th_invoice_status")))])])]),t._v(" "),r("tbody",t._l(t.orders,(function(t){return r("order-row",{key:t.id,attrs:{order:t}})})),1)])])};o._withStripped=!0;var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("tr",[r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.selected,expression:"selected"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.selected)?t._i(t.selected,null)>-1:t.selected},on:{change:function(e){var r=t.selected,s=e.target,i=!!s.checked;if(Array.isArray(r)){var n=t._i(r,null);s.checked?n<0&&(t.selected=r.concat([null])):n>-1&&(t.selected=r.slice(0,n).concat(r.slice(n+1)))}else t.selected=i}}})]),t._v(" "),r("td",[r("a",{attrs:{href:t.order.edit_url}},[t._v(t._s(t.label))])]),t._v(" "),r("td",[r("div",{staticStyle:{display:"inline-block",padding:"8px",background:"#eee","border-radius":"2px"}},[t._v(t._s(t.order.status))])]),t._v(" "),r("td",[t._v(t._s(t.order.shipping_method))]),t._v(" "),r("td",[t._v(t._s(t.order.created_at))]),t._v(" "),r("td",{domProps:{innerHTML:t._s(t.order.total)}}),t._v(" "),r("td",{staticClass:"text-center"},[t.defaultState?r("div",[t.order.ttn_id?r("span",[t._v(t._s(t.order.ttn_id))]):r("div",[r("a",{attrs:{href:t.ttnFormUrl(t.order)}},[t._v(t._s(t.$t("row_create_ttn")))])])]):t._e(),t._v(" "),t.queueWaitingState?r("div",{staticStyle:{color:"#aaa"}},[t._v(t._s(t.$t("state_queue")))]):t._e(),t._v(" "),t.deletingState?r("div",{staticStyle:{color:"#f00"}},[t._v(t._s(t.$t("state_deleting")))]):t._e(),t._v(" "),t.errorTTNCreatingState?r("div",{staticStyle:{color:"#f00"}},t._l(t.order.errors,(function(e){return r("div",[t._v(t._s(e))])})),0):t._e()]),t._v(" "),r("td",{staticStyle:{width:"20%"}},["PENDING"===t.order.cloud_status?r("div",[t._v(t._s(t.order.cloud_status))]):t._e(),t._v(" "),t.order.carrier_status?r("div",[t._v("\n      ["+t._s(t.order.carrier_status)+"] "+t._s(t.order.carrier_status_additional)+"\n    ")]):t._e()])])};a._withStripped=!0;const c="default",d="waiting",l="deleting",_="error_creating_ttn";var u=s({i18n:r,props:["order"],computed:{label:function(){return"#"+this.order.id+" "+this.order.firstname+" "+this.order.lastname},selected:{get:function(){return this.order.selected},set:function(t){t?this.$store.commit("orders/selectOrder",this.order.id):this.$store.commit("orders/deselectOrder",this.order.id)}},defaultState:function(){return c===this.order.state},queueWaitingState:function(){return d===this.order.state},errorTTNCreatingState:function(){return _===this.order.state},deletingState:function(){return l===this.order.state}},methods:{ttnFormUrl:t=>wc_ukr_shipping_globals.adminUrl+"admin.php?page=wc_ukr_shipping_ttn&order_id="+t.id}},a,[],!1,null,null,null);u.options.__file="frontend/js/order-list/components/order-row.vue";var p=s({components:{"order-row":u.exports},i18n:r,computed:{...WCUkrShipping.UI.mapState("orders",["orders","loading"])},mounted:function(){this.loadOrders()},methods:{...WCUkrShipping.UI.mapActions("orders",["loadOrders"])}},o,[],!1,null,null,null);p.options.__file="frontend/js/order-list/components/order-list.vue";var h=s({components:{toolbar:n,"order-list":p.exports},i18n:r},t,[],!1,null,null,null);h.options.__file="frontend/js/order-list/components/app.vue";const v=h.exports,g={ordersWithTTN:t=>t.orders.filter((t=>t.selected&&t.ttn_id)),ordersWithoutTTN:t=>t.orders.filter((t=>t.selected&&!t.ttn_id))},f={selectOrder(t,e){for(let r=0;r<t.orders.length;r++)if(t.orders[r].id===e)return void(t.orders[r].selected=!0)},deselectOrder(t,e){for(let r=0;r<t.orders.length;r++)if(t.orders[r].id===e)return void(t.orders[r].selected=!1)}};class m{constructor(){this.$=window.jQuery,this.successHandler=null,this.errorHandler=null,this.responseHandler=null,this.xhr=null}success(t){return this.successHandler=t,this}catch(t){return this.errorHandler=t,this}response(t){return this.responseHandler=t,this}abort(){return this.xhr&&this.xhr.abort(),this}post(t,e){let r=this,s=r.$;return this.xhr=s.ajax({method:"POST",url:wc_ukr_shipping_globals.ajaxUrl,data:Object.assign({action:t,_token:wc_ukr_shipping_globals.nonce},e),dataType:"json",success:function(t){"function"==typeof r.successHandler&&r.successHandler(t)},error:function(t,e,s){"function"==typeof r.errorHandler?r.errorHandler(t,e,s):alert(`${t.status} ${t.statusText}`)},complete:function(){"function"==typeof r.responseHandler&&r.responseHandler()}}),this}}const T=function(t,e){return window.jQuery||console.error("jQuery not found."),(new m).post(t,e)},w={getOrders(t,e,r){T("wcus_orders_list",{page:t,limit:e}).success((function(t){r(t)})).catch((function(t,e,s){r({success:!1,error:e})}))}},b=async(t,e)=>new Promise(((r,s)=>{T("wcus_generate_ttn",{order_id:t,options:e}).success((t=>{r(t)}))})),k=async t=>new Promise(((e,r)=>{T("wcus_ttn_delete",{ttn_id:t}).success((t=>{e(t)}))})),S={loadOrders({commit:t,state:e}){e.loading=!0,w.getOrders(e.page,e.limit,(t=>{t.success&&(e.orders=t.data.orders,e.count_pages=t.data.count_pages),e.loading=!1}))},async createOrdersTTN({commit:t,getters:e,state:r}){e.ordersWithoutTTN.forEach((t=>{t.state=d}));for(let t of e.ordersWithoutTTN){const e=await b(t.id,r.options);e.success?(t.ttn_id=e.data.ttn_id,t.ttn_db_id=e.data.ttn_db_id,t.ttn_ref=e.data.ttn_ref,t.carrier_status=e.data.carrier_status,t.carrier_status_additional=e.data.carrier_status_additional,t.state=c):(t.errors=e.errors,t.state=_)}},printTTN({commit:t,getters:e}){window.WCUkrShipping.Printer.open(e.ordersWithTTN.map((t=>t.ttn_db_id)))},async deleteTTN({commit:t,getters:e}){e.ordersWithTTN.forEach((t=>{t.state=l}));for(let t of e.ordersWithTTN)(await k(t.ttn_db_id)).success&&(t.ttn_id="",t.ttn_db_id="",t.ttn_ref="",t.carrier_status="",t.carrier_status_additional=""),t.state=c}};var C;window.WcusOrders={init(t){WCUkrShipping.UI.registerStore("orders",function(t){return{state:{orders:[],limit:20,page:1,count_pages:1,loading:!1,options:t},getters:g,mutations:f,actions:S}}(t)),WCUkrShipping.UI.createApp("#wcus-order-list",{render:t=>t(v)})}},(C=jQuery)(".j-wcus-ttn-status").on("click",(function(t){t.preventDefault();let e=C(this);WCUkrShippingRouter.post("wc_ukr_shipping_update_ttn_status",{params:{ttn_id:this.dataset.ttn},success:function(t){t.success?e.prev().html(t.data.status):t.exception&&console.error(t.exception)}})}))})();